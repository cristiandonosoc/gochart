{{- $root := . -}}
// File generated by Gochart version "{{.Version}}" at {{.Time}}
// DO NOT MODIFY!

#pragma once

#include <array>
#include <cassert>
#include <memory>

namespace gochart {

class {{.ImplName}}
{
public:
    using ElementType = uint32_t;

public:
	// Triggers.
	enum class TriggerKind
	{
		{{- range .Statechart.Triggers }}
		{{.Name}},
		{{- end }}
		None,
	};

	{{- range .Statechart.Triggers }}

	struct Trigger{{.Name}}
	{
		static TriggerKind GetKind() { return TriggerKind::{{.Name}}; }
		static const char* GetName();

		// Args.
		{{- range .Args }}
		{{.Type}} {{.Name}};
		{{- end }}
	};

	{{- end }}

	// States.
	enum class StateKind
	{
		{{- range .Statechart.States}}
		{{.Name}},
		{{- end}}
		None,
	};
	static const char* ToString(StateKind state);
	static StateKind ParentState(StateKind state);

	{{- range .Statechart.States }}

	struct State{{.Name}}
	{
		static StateKind GetParent() { return StateKind::{{.ParentName}}; }
	};
	{{- end }}


private:
    class RingBuffer
    {
    public:
        bool IsEmpty() const { return ReadIndex == WriteIndex; }
        bool IsFull() const { return ((WriteIndex + 1) % TriggerQueue.size()) == ReadIndex; }

        void Enqueue(const ElementType &element);
        void Dequeue(ElementType *out);

    private:
        // TODO(cdc): Make queue size configurable.
        std::array<ElementType, 32> TriggerQueue;
        std::size_t ReadIndex;
        std::size_t WriteIndex;
    };
};

template <typename TOwner>
class {{.InterfaceName}} {
public:
	std::unique_ptr<{{.InterfaceName}}> Create(TOwner* owner)
	{
		return std::unique_ptr<{{.InterfaceName}}>(new {{.InterfaceName}}(owner));
	}

public:
	// Trigger Interface.
	{{- range .Statechart.Triggers }}
	void Trigger{{.Name}}({{ .ArgsStringList | join ", " }});
	{{- end }}

	// State Interface.
	{{- range .Statechart.States }}
	{{- if .DefaultEnter }}
	void State{{.Name}}_OnEnter();
	{{- end }}

	{{- if .DefaultExit }}
	void State{{.Name}}_OnExit();
	{{- end }}
	{{- end }}

private:
	{{.InterfaceName}}() = delete;
	{{.InterfaceName}}(TOwner* owner) : Owner(owner) {}

	// No copy construction.
	{{.InterfaceName}}(const {{.InterfaceName}}&) = delete;
	{{.InterfaceName}}& operator=(const {{.InterfaceName}}&) = delete;

	// No move construction.
	{{.InterfaceName}}({{.InterfaceName}}&&) = delete;
	{{.InterfaceName}}& operator=({{.InterfaceName}}&&) = delete;


private:
	TOwner* Owner = nullptr;
};

} // namespace gochart
